
import streamlit as st
st.set_page_config(page_title="ìž…ì°°ìµœì ê°€ë¶„ì„ê¸°", layout="wide")
import pandas as pd

st.title("ðŸ“Š ìž…ì°°ìµœì ê°€ë¶„ì„ê¸°")

# -------------------------------
# ì„¤ì •ê°’
ìž…ì°°ë¥ ê¸°ì¤€ = {"5ì–µ ë¯¸ë§Œ": 0.8675, "10ì–µ ë¯¸ë§Œ": 0.855, "10ì–µ ì´ìƒ": 0.8}
ê¸°ìˆ ì ìˆ˜_ìµœì†Œ = 95

# -------------------------------
# ì‚¬ìš©ìž ìž…ë ¥
st.header("1. ê¸°ë³¸ ì •ë³´ ìž…ë ¥")
col1, col2 = st.columns(2)
with col1:
    ê¸°ì´ˆê¸ˆì•¡ = st.number_input("ê¸°ì´ˆê¸ˆì•¡ ìž…ë ¥ (â‚©)", min_value=1000000, step=1000000, format="%d")
with col2:
    ì‚¬ì—…ê·œëª¨ = st.selectbox("ì‚¬ì—… ê·œëª¨", ["5ì–µ ë¯¸ë§Œ", "10ì–µ ë¯¸ë§Œ", "10ì–µ ì´ìƒ"])

# -------------------------------
# ì‹¬ì‚¬ê¸°ì¤€ ì ìˆ˜í‘œ
ê¸°ì¤€ì ìˆ˜ = {
    "5ì–µ ë¯¸ë§Œ": {"ì‚¬ì—…ìˆ˜í–‰ëŠ¥ë ¥": 35, "ì§€ì—­ì—…ì²´ì°¸ì—¬": 8, "ê²½ì˜ìƒíƒœ": 2, "ìž…ì°°ê°€ê²©": 60, "ê¸°ìˆ ìžë³´ìœ ": -10, "ê³„ì•½ì§ˆì„œ": -1},
    "10ì–µ ë¯¸ë§Œ": {"ì‚¬ì—…ìˆ˜í–‰ëŠ¥ë ¥": 45, "ì§€ì—­ì—…ì²´ì°¸ì—¬": 8, "ê²½ì˜ìƒíƒœ": 2, "ìž…ì°°ê°€ê²©": 50, "ê¸°ìˆ ìžë³´ìœ ": -10, "ê³„ì•½ì§ˆì„œ": -1},
    "10ì–µ ì´ìƒ": {"ì‚¬ì—…ìˆ˜í–‰ëŠ¥ë ¥": 65, "ì§€ì—­ì—…ì²´ì°¸ì—¬": 8, "ê²½ì˜ìƒíƒœ": 2, "ìž…ì°°ê°€ê²©": 30, "ê¸°ìˆ ìžë³´ìœ ": -10, "ê³„ì•½ì§ˆì„œ": -1},
}

í˜„ìž¬ê¸°ì¤€ = ê¸°ì¤€ì ìˆ˜[ì‚¬ì—…ê·œëª¨]
ë‚™ì°°ìž…ì°°ë¥  = ìž…ì°°ë¥ ê¸°ì¤€[ì‚¬ì—…ê·œëª¨]
ìž…ì°°ê°€ê²© = round(ê¸°ì´ˆê¸ˆì•¡ * ë‚™ì°°ìž…ì°°ë¥ )

st.header("2. ì‹¬ì‚¬ í•­ëª©ë³„ ë‹¹ì‚¬ í‰ì  ìž…ë ¥")
col1, col2, col3 = st.columns(3)
with col1:
    ì _ì‚¬ì—… = st.number_input("ì‚¬ì—…ìˆ˜í–‰ëŠ¥ë ¥", min_value=0.0, max_value=float(í˜„ìž¬ê¸°ì¤€["ì‚¬ì—…ìˆ˜í–‰ëŠ¥ë ¥"]), step=0.5)
    ì _ì§€ì—­ = st.number_input("ì§€ì—­ì—…ì²´ì°¸ì—¬ë„", min_value=0.0, max_value=8.0, step=0.5)
with col2:
    ì _ê²½ì˜ìƒíƒœ = st.number_input("ê²½ì˜ìƒíƒœ", min_value=0.0, max_value=2.0, step=0.5)
with col3:
    ì _ê¸°ìˆ ìž = st.number_input("ê¸°ìˆ ìžë³´ìœ  ê°ì  (ì—†ìœ¼ë©´ 0)", min_value=-10.0, max_value=0.0, step=1.0)
    ì _ê³„ì•½ì§ˆì„œ = st.number_input("ê³„ì•½ì§ˆì„œ ê°ì  (ì—†ìœ¼ë©´ 0)", min_value=-1.0, max_value=0.0, step=1.0)

# -------------------------------
# ì˜ˆì •ê°€ê²© ê³„ì‚°
ì˜ˆê°€ìœ¨ëª©ë¡ = [round(x, 1) for x in list(pd.Series(range(-30, 31, 5)) / 10)]
ì˜ˆì •ê°€ê²©í‘œ = {ìœ¨: round(ê¸°ì´ˆê¸ˆì•¡ * (1 + ìœ¨ / 100)) for ìœ¨ in ì˜ˆê°€ìœ¨ëª©ë¡}
ì˜ˆì •ê°€ê²©_í‰ê·  = round(sum(list(ì˜ˆì •ê°€ê²©í‘œ.values())[5:9]) / 4)

# -------------------------------
# ì ìˆ˜ê³„ì‚°
ìž…ì°°ë¥  = ìž…ì°°ê°€ê²© / ì˜ˆì •ê°€ê²©_í‰ê·  if ì˜ˆì •ê°€ê²©_í‰ê·  > 0 else 0
ê°€ê²©ì ìˆ˜ = max(0, í˜„ìž¬ê¸°ì¤€["ìž…ì°°ê°€ê²©"] * ((1 - ìž…ì°°ë¥ ) / (1 - ë‚™ì°°ìž…ì°°ë¥ ))) if ìž…ì°°ë¥  >= ë‚™ì°°ìž…ì°°ë¥  else 0
ì´ì  = ì _ì‚¬ì—… + ì _ì§€ì—­ + ì _ê²½ì˜ìƒíƒœ + ì _ê¸°ìˆ ìž + ì _ê³„ì•½ì§ˆì„œ + ê°€ê²©ì ìˆ˜

# -------------------------------
# ì¶œë ¥
st.header("3. ê²°ê³¼ ë¶„ì„")
st.subheader("ì˜ˆì •ê°€ê²© ì‹œë®¬ë ˆì´ì…˜")
ì˜ˆì •ê°€ê²©í‘œ_df = pd.DataFrame.from_dict(ì˜ˆì •ê°€ê²©í‘œ, orient='index', columns=['ì˜ˆì •ê°€ê²©']).rename_axis('ì˜ˆê°€ìœ¨')
ì˜ˆì •ê°€ê²©í‘œ_df['ìž…ì°°ê°€ê²©'] = (ì˜ˆì •ê°€ê²©í‘œ_df['ì˜ˆì •ê°€ê²©'] * ë‚™ì°°ìž…ì°°ë¥ ).round().astype(int)
ì˜ˆì •ê°€ê²©í‘œ_df['ì˜ˆì •ê°€ê²©'] = ì˜ˆì •ê°€ê²©í‘œ_df['ì˜ˆì •ê°€ê²©'].apply(lambda x: f"{x:,}")
ì˜ˆì •ê°€ê²©í‘œ_df['ìž…ì°°ê°€ê²©'] = ì˜ˆì •ê°€ê²©í‘œ_df['ìž…ì°°ê°€ê²©'].apply(lambda x: f"{x:,}")
st.write(ì˜ˆì •ê°€ê²©í‘œ_df)

st.subheader("ìž…ì°°ê²°ê³¼ ë¶„ì„")
st.markdown(f"- **ì˜ˆì •ê°€ê²©(í‰ê· )**: {ì˜ˆì •ê°€ê²©_í‰ê· :,}ì›")
st.markdown(f"- **ìž…ì°°ê°€ê²©** (Ã— {ë‚™ì°°ìž…ì°°ë¥ }): {ìž…ì°°ê°€ê²©:,}ì›")
st.markdown(f"- **ìž…ì°°ë¥ **: {ìž…ì°°ë¥ :.4f}")
st.markdown(f"- **ìž…ì°°ê°€ê²© ì ìˆ˜**: {ê°€ê²©ì ìˆ˜:.2f} / {í˜„ìž¬ê¸°ì¤€['ìž…ì°°ê°€ê²©']}")
st.markdown(f"- **ê¸°ìˆ ì ìˆ˜ ì´í•©**: {ì _ì‚¬ì—… + ì _ì§€ì—­ + ì _ê²½ì˜ìƒíƒœ + ì _ê¸°ìˆ ìž + ì _ê³„ì•½ì§ˆì„œ:.2f}")

# -------------------------------
# ðŸ“Œ ì‚¬ìš©ìžê°€ ìž…ì°°ê°€ë¥¼ ì„ íƒí•˜ì—¬ ë¶„ì„
st.subheader("ìž…ì°°ê°€ê²© ì„ íƒ ì‹œ ìžë™ ë¶„ì„")

ì„ íƒìž…ì°°ê°€ = st.selectbox("ìž…ì°°ê°€ê²© ì„ íƒ (ì˜ˆì •ê°€ê²© ì‹œë®¬ë ˆì´ì…˜ ì°¸ê³ )", [int(str(x).replace(",", "")) for x in ì˜ˆì •ê°€ê²©í‘œ_df["ìž…ì°°ê°€ê²©"]])

# ì„ íƒëœ ìž…ì°°ê°€ ê¸°ì¤€ ìž…ì°°ë¥  ë° ì ìˆ˜ ìž¬ê³„ì‚°
ì„ íƒìž…ì°°ë¥  = ì„ íƒìž…ì°°ê°€ / ì˜ˆì •ê°€ê²©_í‰ê·  if ì˜ˆì •ê°€ê²©_í‰ê·  > 0 else 0

if ê¸°ì´ˆê¸ˆì•¡ < 500_000_000:
    ì„ íƒìž…ì°°ê¸°ì¤€ = 0.8675
    ì„ íƒê°€ê²©ì ìˆ˜ = 60 - 4 * abs(ì„ íƒìž…ì°°ê¸°ì¤€ - ì„ íƒìž…ì°°ë¥ )
elif ê¸°ì´ˆê¸ˆì•¡ < 1_000_000_000:
    ì„ íƒìž…ì°°ê¸°ì¤€ = 0.855
    ì„ íƒê°€ê²©ì ìˆ˜ = 50 - 2 * abs(ì„ íƒìž…ì°°ê¸°ì¤€ - ì„ íƒìž…ì°°ë¥ )
else:
    ì„ íƒìž…ì°°ê¸°ì¤€ = 0.8
    ì„ íƒê°€ê²©ì ìˆ˜ = 30 - abs(ì„ íƒìž…ì°°ê¸°ì¤€ - ì„ íƒìž…ì°°ë¥ )

ì„ íƒê°€ê²©ì ìˆ˜ = max(0, ì„ íƒê°€ê²©ì ìˆ˜)
ì„ íƒì´ì  = ì _ì‚¬ì—… + ì _ì§€ì—­ + ì _ê²½ì˜ìƒíƒœ + ì _ê¸°ìˆ ìž + ì _ê³„ì•½ì§ˆì„œ + ì„ íƒê°€ê²©ì ìˆ˜

st.markdown(f"- **ì„ íƒ ìž…ì°°ê°€ê²©**: {ì„ íƒìž…ì°°ê°€:,}ì›")
st.markdown(f"- **ì„ íƒ ìž…ì°°ë¥ **: {ì„ íƒìž…ì°°ë¥ :.4f}")
st.markdown(f"- **ì„ íƒ ìž…ì°°ê°€ê²© ì ìˆ˜**: {ì„ íƒê°€ê²©ì ìˆ˜:.2f} / {í˜„ìž¬ê¸°ì¤€['ìž…ì°°ê°€ê²©']}")
st.markdown(f"- **ì„ íƒ ì´ì **: {ì„ íƒì´ì :.2f} / 100")

# ë‚™ì°° ê¸°ì¤€ì ìˆ˜ íŒë‹¨ ë¡œì§
if ê¸°ì´ˆê¸ˆì•¡ < 500_000_000:
    ê¸°ì¤€ì ìˆ˜ = 95
    ë‚™ì°°ì¡°ê±´ì„¤ëª… = "95ì  ì´ìƒì´ì–´ì•¼ í•˜ë©°, ê·¸ ì¤‘ 95ì ì— ê°€ìž¥ ê·¼ì ‘í•œ ìžê°€ ë‚™ì°° ëŒ€ìƒìž…ë‹ˆë‹¤."
elif ê¸°ì´ˆê¸ˆì•¡ < 1_000_000_000:
    ê¸°ì¤€ì ìˆ˜ = 95
    ë‚™ì°°ì¡°ê±´ì„¤ëª… = "95ì ì— ê°€ìž¥ ê·¼ì ‘í•œ ìžê°€ ë‚™ì°° ëŒ€ìƒìž…ë‹ˆë‹¤."
else:
    ê¸°ì¤€ì ìˆ˜ = 92
    ë‚™ì°°ì¡°ê±´ì„¤ëª… = "92ì ì— ê°€ìž¥ ê·¼ì ‘í•œ ìžê°€ ë‚™ì°° ëŒ€ìƒìž…ë‹ˆë‹¤."

if ì„ íƒì´ì  < ê¸°ì¤€ì ìˆ˜:
    st.error(f"âŒ ì´ì  {ì„ íƒì´ì :.2f}ì ì€ ê¸°ì¤€ì ìˆ˜ {ê¸°ì¤€ì ìˆ˜}ì  ë¯¸ë§Œìœ¼ë¡œ ë‚™ì°° ë¶ˆê°€")
else:
    ì°¨ì´ = abs(ì„ íƒì´ì  - ê¸°ì¤€ì ìˆ˜)
    st.success(f"âœ… ì´ì  {ì„ íƒì´ì :.2f}ì  â†’ ê¸°ì¤€ì ìˆ˜ {ê¸°ì¤€ì ìˆ˜}ì ê³¼ì˜ ì°¨ì´: {ì°¨ì´:.2f}ì ")
    st.info(f"ðŸ“Œ {ë‚™ì°°ì¡°ê±´ì„¤ëª…}")


